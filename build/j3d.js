J3D={};J3D.PHONG_SHADER_MAX_LIGHTS=4;var v3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};v3.prototype.set=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};v3.prototype.magSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z};v3.prototype.mag=function(){return Math.sqrt(this.magSq())};v3.prototype.mul=function(a){return new v3(this.x*a,this.y*a,this.z*a)};v3.prototype.neg=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};
v3.prototype.norm=function(){var a=1/this.mag();this.set(this.x*a,this.y*a,this.z*a);return this};v3.prototype.cp=function(){return new v3(this.x,this.y,this.z)};v3.prototype.add=function(a){return v3.add(this,a)};v3.prototype.xyz=function(){return[this.x,this.y,this.z]};v3.add=function(a,b){var c=new v3(a.x,a.y,a.z);c.x+=b.x;c.y+=b.y;c.z+=b.z;return c};v3.prototype.sub=function(a){return v3.sub(this,a)};v3.sub=function(a,b){var c=new v3(a.x,a.y,a.z);c.x-=b.x;c.y-=b.y;c.z-=b.z;return c};
v3.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};v3.cross=function(a,b){return new v3(a.y*b.z-a.z*b.y,a.z*b.x-a.x*b.z,a.x*b.y-a.y*b.x)};v3.ZERO=function(){return new v3(0,0,0)};v3.ONE=function(){return new v3(1,1,1)};v3.RIGHT=function(){return new v3(1,0,0)};v3.UP=function(){return new v3(0,1,0)};v3.FORWARD=function(){return new v3(0,0,1)};var Color=function(a,b,c,e){var d=this;this.r=a;this.g=b;this.b=c;this.a=e;this.rgba=function(){return[d.r,d.g,d.b,d.a]};this.rgb=function(){return[d.r,d.g,d.b]}};Color.white=new Color(1,1,1,1);Color.black=new Color(0,0,0,1);var m44=function(){this.array=new Float32Array(16);this.identity()};m44.prototype.identity=function(){this.n11=1;this.n21=this.n14=this.n13=this.n12=0;this.n22=1;this.n32=this.n31=this.n24=this.n23=0;this.n33=1;this.n43=this.n42=this.n41=this.n34=0;this.n44=1};m44.prototype.perspective=function(a,b,c,e){a=c*Math.tan(a*Math.PI/360);var d=e-c;this.n11=c/(a*b);this.n22=c/a;this.n33=-(e+c)/d;this.n34=-(2*e*c)/d;this.n43=-1;this.n44=0};
m44.prototype.toArray=function(){this.array[0]=this.n11;this.array[1]=this.n21;this.array[2]=this.n31;this.array[3]=this.n41;this.array[4]=this.n12;this.array[5]=this.n22;this.array[6]=this.n32;this.array[7]=this.n42;this.array[8]=this.n13;this.array[9]=this.n23;this.array[10]=this.n33;this.array[11]=this.n43;this.array[12]=this.n14;this.array[13]=this.n24;this.array[14]=this.n34;this.array[15]=this.n44;return this.array};var gl;J3D.Engine=function(){var a;a=document.createElement("canvas");a.width=window.innerWidth;a.height=window.innerHeight;document.body.appendChild(a);try{gl=a.getContext("experimental-webgl"),gl.viewportWidth=a.width,gl.viewportHeight=a.height}catch(b){console.log("Error initializing webgl: "+b)}gl.clearColor(0,0,0,1);gl.enable(gl.DEPTH_TEST);gl.cullFace(gl.FRONT);this.gl=gl;this.shaderAtlas=new J3D.ShaderAtlas;this.scene=new J3D.Scene;this.canvas=a;this._opaqueMeshes=[];this._lights=[]};
J3D.Engine.prototype.render=function(){Time.tick();gl.viewport(0,0,gl.viewportWidth,gl.viewportHeight);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);this._opaqueMeshes.length=0;for(var a=this._lights.length=0;a<this.scene.numChildren;a++)this.updateTransform(this.scene.childAt(a),null);this.camera.updateInverse();for(a=0;a<this._lights.length;a++){var b=this._lights[a];b.updateWorldPosition(this.camera.inverseMat)}for(a=0;a<this._opaqueMeshes.length;a++){b=this._opaqueMeshes[a];var c=this.shaderAtlas.getShader(b.renderer);
b.updateViewAndNormal(this.camera.inverseMat);gl.useProgram(c);b.renderer.setup(b.mesh,c,this._lights,this.scene.ambient);b.mesh.bindBuffers();gl.uniformMatrix4fv(c.projMat,!1,this.camera.projectionMat.toArray());gl.uniformMatrix4fv(c.mvMat,!1,b.viewMatrix);gl.uniformMatrix3fv(c.nMat,!1,b.normalMatrix);b.enabled&&b.mesh.draw()}gl.enable(gl.DEPTH_TEST);gl.disable(gl.BLEND)};
J3D.Engine.prototype.updateTransform=function(a,b){a.updateWorld(b);for(var c=0;c<a.numChildren;c++)this.updateTransform(a.childAt(c),a);a.enabled&&(a.renderer&&a.mesh&&this._opaqueMeshes.push(a),a.light&&this._lights.push(a))};J3D.Scene=function(){var a=this,b=[];this.add=function(c){b.push(c);c.parent=null;a.numChildren=b.length;return c};this.childAt=function(a){return b[a]};this.ambient=Color.black};J3D.Mesh=function(a){this.vertSize=3;this.uvSize=2;this.colorSize=4;this.vertices=new Float32Array(a.vertices);this.vertNum=a.vertices.length/this.vertSize;this.tris=new Uint16Array(a.tris);this.triNum=a.tris.length;this.colors=new Float32Array(a.colors);this.normals=new Float32Array(a.normals);this.uv1=(this.hasUV1=a.uv1.length>0)?new Float32Array(a.uv1):new Float32Array(this.vertNum*this.uvSize);this.buffersReady=!1};
J3D.Mesh.prototype.draw=function(){gl.drawElements(gl.TRIANGLES,this.triNum,gl.UNSIGNED_SHORT,0)};
J3D.Mesh.prototype.bindBuffers=function(){if(!this.buffersReady)this.vertBuf=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,this.vertBuf),gl.bufferData(gl.ARRAY_BUFFER,this.vertices,gl.STATIC_DRAW),this.colorBuf=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,this.colorBuf),gl.bufferData(gl.ARRAY_BUFFER,this.colors,gl.STATIC_DRAW),this.normBuf=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,this.normBuf),gl.bufferData(gl.ARRAY_BUFFER,this.normals,gl.STATIC_DRAW),this.uv1buf=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,
this.uv1buf),gl.bufferData(gl.ARRAY_BUFFER,this.uv1,gl.STATIC_DRAW),this.triBuf=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.triBuf),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.tris,gl.STATIC_DRAW),this.buffersReady=!0};J3D.Light=function(a){this.type=a||J3D.NONE;this.direction=v3.ZERO();this.color=Color.white};J3D.NONE=parseInt(0);J3D.DIRECT=parseInt(1);J3D.POINT=parseInt(2);J3D.Camera=function(a,b,c,e){this.projectionMat=new m44;this.projectionMat.perspective(a,b,c,e);this.inverseMat=mat4.create()};J3D.Camera.prototype.updateInverse=function(){mat4.inverse(this.transform.globalMatrix,this.inverseMat)};J3D.Camera.create=function(a,b,c){var e=new J3D.Transform;a=new J3D.Camera(a,gl.viewportWidth/gl.viewportHeight,b,c);e.camera=a;a.transform=e;return a};J3D.Texture=function(a){var b=this;this.tex=gl.createTexture();typeof a=="string"&&function(a){b.img=new Image;b.img.onload=function(){gl.bindTexture(gl.TEXTURE_2D,b.tex);gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,!0);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,b.img);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.bindTexture(gl.TEXTURE_2D,null)};b.img.src=a}(a)};J3D.Transform=function(){var a=this,b=[];this.numChildren=0;this.position=v3.ZERO();this.rotation=v3.ZERO();this.scale=v3.ONE();this.worldPosition=v3.ZERO();this.matrix=mat4.create();this.globalMatrix=mat4.create();this.viewMatrix=mat4.create();this.normalMatrix=mat3.create();this._lockedMatrix=this.isStatic=!1;this.enabled=!0;this.add=function(c){b.push(c);a.numChildren=b.length;return c};this.childAt=function(a){return b[a]}};
J3D.Transform.prototype.clone=function(){var a=new J3D.Transform;a.position=this.position.cp();a.rotation=this.rotation.cp();a.scale=this.scale.cp();a.isStatic=this.isStatic;a.renderer=this.renderer;a.mesh=this.mesh;a.camera=this.camera;a.light=this.light;return a};
J3D.Transform.prototype.updateWorld=function(a){if(!this._lockedMatrix&&(mat4.identity(this.matrix),mat4.translate(this.matrix,[this.position.x,this.position.y,this.position.z]),mat4.rotateZ(this.matrix,this.rotation.z),mat4.rotateY(this.matrix,this.rotation.y),mat4.rotateX(this.matrix,this.rotation.x),mat4.scale(this.matrix,[this.scale.x,this.scale.y,this.scale.z]),a!=null?mat4.multiply(a.globalMatrix,this.matrix,this.globalMatrix):this.globalMatrix=this.matrix,this.isStatic))this._lockedMatrix=
!0};J3D.Transform.prototype.updateViewAndNormal=function(a){mat4.multiply(a,this.globalMatrix,this.viewMatrix);mat4.toInverseMat3(this.viewMatrix,this.normalMatrix);mat3.transpose(this.normalMatrix)};J3D.Transform.prototype.updateWorldPosition=function(a){var b=this.position.xyz();mat4.multiplyVec3(this.globalMatrix,b);mat4.multiplyVec3(a,b);this.worldPosition.x=b[0];this.worldPosition.y=b[1];this.worldPosition.z=b[2]};J3D.ShaderSource={};J3D.ShaderAtlas=function(){this.shaders={};this.programs={};this.shaderCount=0};J3D.ShaderAtlas.prototype.compileShaderSource=function(a,b,c){c=gl.createShader(c);gl.shaderSource(c,b);gl.compileShader(c);gl.getShaderParameter(c,gl.COMPILE_STATUS)||console.log("Shader compile error: "+gl.getShaderInfoLog(c));this.programs[a]=c};
J3D.ShaderAtlas.prototype.linkShader=function(a,b){var c=this.programs[b+"Vert"],e=this.programs[b+"Frag"],d=gl.createProgram();gl.attachShader(d,c);gl.attachShader(d,e);gl.linkProgram(d);gl.getProgramParameter(d,gl.LINK_STATUS)||console.log("Error creating program "+b);gl.useProgram(d);a.setupLocations(d);this.shaderCount++;this.shaders[b]=d};
J3D.ShaderAtlas.prototype.getShader=function(a){var b=a.shaderName;if(!this.shaders[b]){var c=J3D.ShaderSource[b];this.compileShaderSource(b+"Vert",c.vert,gl.VERTEX_SHADER);this.compileShaderSource(b+"Frag",c.frag,gl.FRAGMENT_SHADER);this.linkShader(a,b)}return this.shaders[b]};J3D.ShaderInclude=["#ifdef GL_ES","precision highp float;","#endif","float luminance(vec3 c) {","    return c.r * 0.299 + c.g * 0.587 + c.b * 0.114;","}","float brightness(vec3 c) {","    return c.r * 0.2126 + c.g * 0.7152 + c.b * 0.0722;","}","struct lightSource {","\tint type;","\tvec3 direction;","\tvec3 color;","\tvec3 position;","};","vec3 computeLight(vec4 p, vec3 n, float si, float sh, lightSource light){","    vec3 ld;","    if(light.type == 0) return vec3(0);","    else if(light.type == 1) ld = light.direction;",
"    else if(light.type == 2) ld = normalize(light.position - p.xyz);","    float dif = max(dot(n, ld), 0.0);","    float spec = 0.0;","    if(si > 0.0) {","    \tvec3 eyed = normalize(-p.xyz);","    \tvec3 refd = reflect(-ld, n);","    \tspec = pow(max(dot(refd, eyed), 0.0), sh) * si;","    };","    return light.color * dif + light.color * spec;","}"];normal2ColorShaderName="Normal2Color";J3D.Normal2Color=function(){this.shaderName=normal2ColorShaderName};J3D.Normal2Color.prototype.setupLocations=function(a){a.vertAttr=gl.getAttribLocation(a,"aVertexPosition");gl.enableVertexAttribArray(a.vertAttr);a.normAttr=gl.getAttribLocation(a,"aVertexNormal");gl.enableVertexAttribArray(a.normAttr);a.projMat=gl.getUniformLocation(a,"projMat");a.mvMat=gl.getUniformLocation(a,"uMVMatrix");a.nMat=gl.getUniformLocation(a,"uNMatrix")};
J3D.Normal2Color.prototype.setup=function(a,b){gl.bindBuffer(gl.ARRAY_BUFFER,a.vertBuf);gl.vertexAttribPointer(b.vertAttr,a.vertSize,gl.FLOAT,!1,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,a.normBuf);gl.vertexAttribPointer(b.normAttr,a.vertSize,gl.FLOAT,!1,0,0);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,a.triBuf)};
J3D.ShaderSource[normal2ColorShaderName]={name:normal2ColorShaderName,vert:"attribute vec3 aVertexPosition;\nattribute vec3 aVertexNormal;\nuniform mat4 uMVMatrix;\nuniform mat4 projMat;\nuniform mat3 uNMatrix;\nvarying vec3 vColor;\nvoid main(void) {\n    gl_Position = projMat *  uMVMatrix * vec4(aVertexPosition, 1.0);\n    vColor = normalize( uNMatrix * aVertexNormal );\n}",frag:"#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec3 vColor;\nvoid main(void) {\n   gl_FragColor =  vec4(vColor, 1.0);\n}"};phongShaderName="Phong";J3D.Phong=function(){this.shaderName=phongShaderName;this.color=Color.white;this.specularIntensity=0;this.shininess=32};
J3D.Phong.prototype.setupLocations=function(a){a.vertAttr=gl.getAttribLocation(a,"aVertexPosition");gl.enableVertexAttribArray(a.vertAttr);a.normAttr=gl.getAttribLocation(a,"aVertexNormal");gl.enableVertexAttribArray(a.normAttr);a.uv1Attr=gl.getAttribLocation(a,"aTextureCoord");gl.enableVertexAttribArray(a.uv1Attr);a.projMat=gl.getUniformLocation(a,"projMat");a.mvMat=gl.getUniformLocation(a,"uMVMatrix");a.nMat=gl.getUniformLocation(a,"uNMatrix");a.uAmbientColor=gl.getUniformLocation(a,"uAmbientColor");
a.uLight=[];for(var b=0;b<J3D.PHONG_SHADER_MAX_LIGHTS;b++)a.uLight[b]={},a.uLight[b].type=gl.getUniformLocation(a,"uLight["+b+"].type"),a.uLight[b].direction=gl.getUniformLocation(a,"uLight["+b+"].direction"),a.uLight[b].position=gl.getUniformLocation(a,"uLight["+b+"].position"),a.uLight[b].color=gl.getUniformLocation(a,"uLight["+b+"].color");a.uSpecularIntensity=gl.getUniformLocation(a,"uSpecularIntensity");a.uShininess=gl.getUniformLocation(a,"uShininess");a.uColorSampler=gl.getUniformLocation(a,
"uColorSampler");a.uColor=gl.getUniformLocation(a,"uColor");a.uHasColorSampler=gl.getUniformLocation(a,"uHasColorSampler")};
J3D.Phong.prototype.setup=function(a,b,c,e){gl.bindBuffer(gl.ARRAY_BUFFER,a.vertBuf);gl.vertexAttribPointer(b.vertAttr,a.vertSize,gl.FLOAT,!1,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,a.normBuf);gl.vertexAttribPointer(b.normAttr,a.vertSize,gl.FLOAT,!1,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,a.uv1buf);gl.vertexAttribPointer(b.uv1Attr,a.uvSize,gl.FLOAT,!1,0,0);a.hasUV1?this.colorTexture!=null?(gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,this.colorTexture.tex),gl.uniform1i(b.samplerUniform,0),gl.uniform1i(b.uHasColorSampler,
!0)):(gl.bindTexture(gl.TEXTURE_2D,null),gl.uniform1i(b.uHasColorSampler,!1)):(gl.bindTexture(gl.TEXTURE_2D,null),gl.uniform1i(b.uHasColorSampler,!1));gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,a.triBuf);gl.uniform4fv(b.uColor,this.color.rgba());gl.uniform3fv(b.uAmbientColor,e.rgb());for(a=0;a<J3D.PHONG_SHADER_MAX_LIGHTS;a++)c[a]?(gl.uniform1i(b.uLight[a].type,c[a].light.type),gl.uniform3fv(b.uLight[a].direction,c[a].light.direction.xyz()),gl.uniform3fv(b.uLight[a].color,c[a].light.color.rgb()),gl.uniform3fv(b.uLight[a].position,
c[a].worldPosition.xyz())):gl.uniform1i(b.uLight[a].type,J3D.NONE);gl.uniform1f(b.uSpecularIntensity,this.specularIntensity);gl.uniform1f(b.uShininess,this.shininess)};
J3D.ShaderSource[phongShaderName]={name:phongShaderName,vert:J3D.ShaderInclude.concat(["attribute vec3 aVertexPosition;","attribute vec3 aVertexNormal;","attribute vec2 aTextureCoord;","uniform mat4 uMVMatrix;","uniform mat4 projMat;","uniform mat3 uNMatrix;","uniform vec3 uAmbientColor;","varying vec4 vPosition;","varying vec3 vLight;","varying vec2 vTextureCoord;","varying vec3 vNormal;","void main(void) {","\t vPosition = uMVMatrix * vec4(aVertexPosition, 1.0);","    gl_Position = projMat * vPosition;",
"\t vTextureCoord = aTextureCoord;","    vNormal = uNMatrix * aVertexNormal;","    vLight = uAmbientColor;","}"]).join("\n"),frag:J3D.ShaderInclude.concat(["uniform vec4 uColor;","uniform sampler2D uColorSampler;","uniform bool uHasColorSampler;","varying vec4 vPosition;","varying vec3 vLight;","varying vec2 vTextureCoord;","varying vec3 vNormal;","uniform lightSource uLight[4];","uniform float uSpecularIntensity;","uniform float uShininess;","void main(void) {","\tvec4 tc = uColor.rgba;","\tif(uHasColorSampler) tc *= texture2D(uColorSampler, vTextureCoord);",
"\tvec3 l = vLight;","   float lum = brightness(tc.rgb);","   l += computeLight(vPosition, vNormal, uSpecularIntensity, uShininess, uLight[0]) * lum;","   l += computeLight(vPosition, vNormal, uSpecularIntensity, uShininess, uLight[1]) * lum;","   l += computeLight(vPosition, vNormal, uSpecularIntensity, uShininess, uLight[2]) * lum;","   l += computeLight(vPosition, vNormal, uSpecularIntensity, uShininess, uLight[3]) * lum;","\tgl_FragColor = vec4(tc.rgb * l, uColor.a);","}"]).join("\n")};phongfastShaderName="PhongFast";J3D.PhongFast=function(){this.shaderName=phongfastShaderName;this.color=Color.white;this.specularIntensity=0;this.shininess=32};
J3D.PhongFast.prototype.setupLocations=function(a){a.vertAttr=gl.getAttribLocation(a,"aVertexPosition");gl.enableVertexAttribArray(a.vertAttr);a.normAttr=gl.getAttribLocation(a,"aVertexNormal");gl.enableVertexAttribArray(a.normAttr);a.uv1Attr=gl.getAttribLocation(a,"aTextureCoord");gl.enableVertexAttribArray(a.uv1Attr);a.projMat=gl.getUniformLocation(a,"projMat");a.mvMat=gl.getUniformLocation(a,"uMVMatrix");a.nMat=gl.getUniformLocation(a,"uNMatrix");a.uAmbientColor=gl.getUniformLocation(a,"uAmbientColor");
a.uLight=[];for(var b=0;b<J3D.PHONG_SHADER_MAX_LIGHTS;b++)a.uLight[b]={},a.uLight[b].type=gl.getUniformLocation(a,"uLight["+b+"].type"),a.uLight[b].direction=gl.getUniformLocation(a,"uLight["+b+"].direction"),a.uLight[b].position=gl.getUniformLocation(a,"uLight["+b+"].position"),a.uLight[b].color=gl.getUniformLocation(a,"uLight["+b+"].color");a.uSpecularIntensity=gl.getUniformLocation(a,"uSpecularIntensity");a.uShininess=gl.getUniformLocation(a,"uShininess");a.uColorSampler=gl.getUniformLocation(a,
"uColorSampler");a.uColor=gl.getUniformLocation(a,"uColor");a.uHasColorSampler=gl.getUniformLocation(a,"uHasColorSampler")};
J3D.PhongFast.prototype.setup=function(a,b,c,e){gl.bindBuffer(gl.ARRAY_BUFFER,a.vertBuf);gl.vertexAttribPointer(b.vertAttr,a.vertSize,gl.FLOAT,!1,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,a.normBuf);gl.vertexAttribPointer(b.normAttr,a.vertSize,gl.FLOAT,!1,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,a.uv1buf);gl.vertexAttribPointer(b.uv1Attr,a.uvSize,gl.FLOAT,!1,0,0);a.hasUV1?this.colorTexture!=null?(gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,this.colorTexture.tex),gl.uniform1i(b.samplerUniform,0),
gl.uniform1i(b.uHasColorSampler,!0)):(gl.bindTexture(gl.TEXTURE_2D,null),gl.uniform1i(b.uHasColorSampler,!1)):(gl.bindTexture(gl.TEXTURE_2D,null),gl.uniform1i(b.uHasColorSampler,!1));gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,a.triBuf);gl.uniform4fv(b.uColor,this.color.rgba());gl.uniform3fv(b.uAmbientColor,e.rgb());for(a=0;a<J3D.PHONG_SHADER_MAX_LIGHTS;a++)c[a]?(gl.uniform1i(b.uLight[a].type,c[a].light.type),gl.uniform3fv(b.uLight[a].direction,c[a].light.direction.xyz()),gl.uniform3fv(b.uLight[a].color,
c[a].light.color.rgb()),gl.uniform3fv(b.uLight[a].position,c[a].worldPosition.xyz())):gl.uniform1i(b.uLight[a].type,J3D.NONE);gl.uniform1f(b.uSpecularIntensity,this.specularIntensity);gl.uniform1f(b.uShininess,this.shininess)};
J3D.ShaderSource[phongfastShaderName]={name:phongfastShaderName,vert:J3D.ShaderInclude.concat(["attribute vec3 aVertexPosition;","attribute vec3 aVertexNormal;","attribute vec2 aTextureCoord;","uniform mat4 uMVMatrix;","uniform mat4 projMat;","uniform mat3 uNMatrix;","uniform vec3 uAmbientColor;","uniform lightSource uLight[4];","uniform float uSpecularIntensity;","uniform float uShininess;","varying vec3 vLight;","varying vec2 vTextureCoord;","void main(void) {","\t vec4 p = uMVMatrix * vec4(aVertexPosition, 1.0);",
"    gl_Position = projMat * p;","\t vTextureCoord = aTextureCoord;","    vec3 n = normalize( uNMatrix * aVertexNormal );","    vLight = uAmbientColor;","    vLight += computeLight(p, n, uSpecularIntensity, uShininess, uLight[0]);","    vLight += computeLight(p, n, uSpecularIntensity, uShininess, uLight[1]);","    vLight += computeLight(p, n, uSpecularIntensity, uShininess, uLight[2]);","    vLight += computeLight(p, n, uSpecularIntensity, uShininess, uLight[3]);","}"]).join("\n"),frag:J3D.ShaderInclude.concat(["uniform vec4 uColor;",
"uniform sampler2D uColorSampler;","uniform bool uHasColorSampler;","varying vec3 vLight;","varying vec2 vTextureCoord;","void main(void) {","\tvec4 tc = uColor.rgba;","\tif(uHasColorSampler) tc *= texture2D(uColorSampler, vTextureCoord);","\tgl_FragColor = vec4(tc.rgb * vLight, uColor.a);","}"]).join("\n")};var Time={};Time.time=0;Time.deltaTime=0;Time.tick=function(){var a=(new Date).getTime();if(Time.time!=0)Time.deltaTime=a-Time.time;Time.time=a};if(!window.requestAnimationFrame)window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();
