<html> 
 
<head> 
<title>002 | Cubemap / Skybox / Reflective material | J3D</title> 

<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1"> 

<!--
<script type="text/javascript" src="../lib/glMatrix.js"></script>
<script type="text/javascript" src="../lib/requestAnimationFrame.js"></script>
<script type="text/javascript" src="../src/J3D.js"></script>
<script type="text/javascript" src="../src/util/Color.js"></script>
<script type="text/javascript" src="../src/math/Vector3.js"></script>
<script type="text/javascript" src="../src/math/Matrix44.js"></script>
<script type="text/javascript" src="../src/engine/Engine.js"></script>
<script type="text/javascript" src="../src/engine/Camera.js"></script>
<script type="text/javascript" src="../src/engine/Light.js"></script>
<script type="text/javascript" src="../src/engine/Mesh.js"></script>
<script type="text/javascript" src="../src/engine/Scene.js"></script>
<script type="text/javascript" src="../src/engine/Loader.js"></script>
<script type="text/javascript" src="../src/engine/ShaderAtlas.js"></script>
<script type="text/javascript" src="../src/engine/Texture.js"></script>
<script type="text/javascript" src="../src/engine/Cubemap.js"></script>
<script type="text/javascript" src="../src/engine/Transform.js"></script>
<script type="text/javascript" src="../src/renderers/ShaderSource.js"></script>
<script type="text/javascript" src="../src/renderers/Phong.js"></script>
<script type="text/javascript" src="../src/renderers/Gouraud.js"></script>
<script type="text/javascript" src="../src/renderers/Normal2Color.js"></script>
<script type="text/javascript" src="../src/renderers/Reflective.js"></script>
<script type="text/javascript" src="../src/renderers/Skybox.js"></script>
<script type="text/javascript" src="../src/util/Time.js"></script>
-->

<script type="text/javascript" src="../build/j3d.js"></script>



<link rel="stylesheet" href="common.css"/>

<script>
	var engine, scene;
	var skybox, root, monkey, camera;
	var mx, my = 0;
	var isMouseDown = false;
	
	function init() {
		
		engine = new J3D.Engine();
		engine.setClearColor(J3D.Color.white);
		
		camera = new J3D.Camera(45);
		camera.transform.position.z = 4;	
		engine.camera = camera;	
		
		r = new J3D.Transform();
		r.position = new v3(0, 0, 0);
		
		engine.scene.ambient = new J3D.Color(0.5, 0.5, 0.5, 0.5);
		
		cubemap = new J3D.Cubemap({
			left: "models/textures/skybox/left.jpg",
			right: "models/textures/skybox/right.jpg",
			up: "models/textures/skybox/up.jpg",
			down: "models/textures/skybox/down.jpg",
			back: "models/textures/skybox/back.jpg",
			front: "models/textures/skybox/front.jpg",
		});

		skybox = new J3D.Transform();
		skybox.renderer = new J3D.Skybox();
		skybox.renderer.cubemap = cubemap;
		J3D.Loader.loadJSON("models/skybox.js", function(j) { skybox.mesh = new J3D.Mesh(j); } );
		engine.scene.add(skybox);
		
		monkey = new J3D.Transform();
		monkey.position = new v3(0, 0, 0);		
		monkey.renderer = new J3D.Reflective();
		monkey.renderer.cubemap = cubemap;
		J3D.Loader.loadJSON("models/monkeyhi.js", function(j) { monkey.mesh = new J3D.Mesh(j); } );
		engine.scene.add(monkey);
		
		r.add(camera.transform);
		
		engine.scene.add(r);
		
		document.onmousemove = onMouseMove;
	
		draw();
	}
	
	function onMouseMove(e) {
		mx = ( e.clientX / window.innerWidth  ) * 2 - 1;
		my = ( e.clientY / window.innerHeight ) * 2 - 1;
	}
	
	function draw() {
		requestAnimationFrame(draw);
		
		if (!isNaN(mx) && !isNaN(my)) {
			r.rotation.x += my * J3D.Time.deltaTime / 1000;
			r.rotation.y += mx * J3D.Time.deltaTime / 2000;
		}
		
		engine.render();
	}
	
</script>

</head> 

<body onload="init();">
</body> 

</html> 